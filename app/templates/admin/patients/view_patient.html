{% extends "base.html" %}

{% block content %}

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="alert alert-{{ category }}">
    <strong>{{ message }}</strong>
</div>
{% endfor %}
{% set _ = session.pop("_flashes", None) %}
{% endif %}
{% endwith %}

<h2>Hist√≥rico do Paciente</h2>

{% if patient %}
<div style="text-align: right; margin-bottom: 10px;">
    <a class="view-custom-history-button" href="{{ url_for('patients.view_custom_history', id=patient.id, pat_name=patient.name) }}">Ver Hist√≥rico Personalizado</a>
</div>

<div class="patient-card">
    <p><strong>Nome:</strong> {{ patient.name }}</p>
    <p><strong>Sexo:</strong> {{ patient.gender }}</p>
    <p><strong>Data de Nascimento:</strong> {{ patient.birth_date.strftime("%d/%m/%Y") }}</p>
    <p><strong>CPF:</strong> {{ patient.cpf }}</p>
    <p><strong>N√∫mero de telefone:</strong> {{ patient.tel_number }}</p>
    <p><strong>E-mail:</strong> {{ patient.email }}</p>
    {% if patient.specialist %}
    <p><strong>Profissional:</strong> {{ patient.specialist.name }} - {{ patient.specialist.email }}</p>
    {% endif %}
    <br>

    <h3>Avalia√ß√£o Antropom√©trica:</h3>
    {% if patient.anthropometric_evaluations|length > 0 %}
    <table class="anthro-table" border="1">
        <thead>
            <tr>
                <th>Data Avalia√ß√£o</th>
                <th>Nome da Guia</th>
                <th>Idade</th>
                <th>Evolu√ß√£o</th>
                <th>Peso Max</th>
                <th>Peso Ideal</th>
                <th>Peso M√≠nimo</th>
                <th>IMC</th>
                <th>Classifica√ß√£o Nutricional</th>
                <th>Necessidade Cal√≥rica</th>
                <th>Ingest√£o de L√≠quido</th>
                <th>Grau Atv. F√≠sica</th>
                <th>Press√£o Arterial</th>
                <th>√öltima Avalia√ß√£o</th>
            </tr>
        </thead>
        <tbody>
            {% for evaluation in patient.anthropometric_evaluations %}
            <tr>
                <td>{{ evaluation.data_avaliacao }}</td>
                <td>{{ evaluation.ultima_guia }}</td>
                <td>{{ evaluation.idade }}</td>
                <td>{{ evaluation.evolucao }}</td>
                <td>{{ evaluation.p_max }}</td>
                <td>{{ evaluation.p_ide }}</td>
                <td>{{ evaluation.p_min }}</td>
                <td>{{ evaluation.imc }}</td>
                <td>{{ evaluation.nutri_class }}</td>
                <td>{{ evaluation.necessidade_calorica }}</td>
                <td>{{ evaluation.ingestao_liquido }}</td>
                <td>{{ evaluation.grau_atv_fisica }}</td>
                <td>{{ evaluation.pa }}</td>
                <td>{{ evaluation.specialist_name }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <br>
    <a href="{{ url_for('patients.add_anthro', patient_id=patient.id) }}">Adicionar Avalia√ß√£o Antropom√©trica</a>
    {% else %}
    <p>N√£o h√° avalia√ß√µes antropom√©tricas registradas.</p>
    <a href="{{ url_for('patients.add_anthro', patient_id=patient.id) }}">Adicionar Avalia√ß√£o Antropom√©trica</a>

    {% endif %}

    <hr>
    <br>

    <h3>Bioimped√¢ncia:</h3>
    {% if patient.skinfolds|length > 0 %}
    <table class="skinfolds-table" border="1">
        <thead>
            <tr>
                <th>Data Medi√ß√£o</th>
                <th>Altura</th>
                <th>Peso</th>
                <th>Massa Muscular</th>
                <th>Gordura</th>
                <th>Abdominal</th>
                <th>Cintura</th>
                <th>Quadril</th>
                <th>Idade Metab√≥lica</th>
            </tr>
        </thead>
        <tbody>
            {% for fold in patient.skinfolds %}
            <tr>
                <td>{{ fold.data_medicao }}</td>
                <td>{{ fold.altura }}</td>
                <td>{{ fold.peso }}</td>
                <td>{{ fold.massa_muscular }}</td>
                <td>{{ fold.gordura }}</td>
                <td>{{ fold.abdominal }}</td>
                <td>{{ fold.cintura }}</td>
                <td>{{ fold.quadril }}</td>
                <td>{{ fold.idade_metabolica }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <br>
    <a href="{{ url_for('patients.add_skinfold', patient_id=patient.id) }}">Adicionar Bioimped√¢ncia</a>
    {% else %}
    <p>N√£o h√° registros de Bioimped√¢ncia.</p>
    <a href="{{ url_for('patients.add_skinfold', patient_id=patient.id) }}">Adicionar Bioimped√¢ncia</a>
    {% endif %}

    <br><br>
    <hr>

    <div class="patient-details">
        <h3>Mais detalhes sobre {{ patient.name }}</h3>
        <br>
        <h4>Hist√≥ria Cl√≠nica:</h4>
        <p><strong>Faz uso de medica√ß√£o?</strong> {{ patient.medication }}</p>
        {% if patient.medication == 'sim' %}
        <p><strong>Quais?</strong> {{ patient.medications_details }}</p>
        {% endif %}
        <p><strong>Funcionamento intestinal:</strong> {{ patient.intestine }} vezes por semana</p>
        <p><strong>Alergias / Intoler√¢ncias?</strong> {{ patient.allergies }}</p>
        {% if patient.allergies == 'sim' %}
        <p><strong>Quais?</strong> {{ patient.allergies_details }}</p>
        {% endif %}
        <p><strong>Consumo de √°gua:</strong> {{ patient.water }} litros/dia</p>
        <p><strong>Azia / Refluxo:</strong> {{ patient.heartburn }}</p>
        <br>

        <h4>Hist√≥ria Comportamental:</h4>
        <p><strong>Faz atividade f√≠sica?</strong> {{ patient.physical_activities }}</p>
        {% if patient.physical_activities == 'sim' %}
        <p><strong>Quais?</strong> {{ patient.physical_details }}</p>
        {% endif %}
        <p><strong>Hor√°rio das atividades:</strong> {{ patient.hours }}</p>
        <p><strong>Frequ√™ncia das atividades:</strong> {{ patient.frequency }} vezes por semana</p>
        <p><strong>Objetivo da consulta:</strong> {{ patient.objective }}</p>
        <br>
    </div>
</div>
{% else %}
<p>Nenhum paciente cadastrado.</p>
{% endif %}

<hr>
<br>
<div class="nav-actions">
    <a class="back-button" href="{{ url_for('patients.list_patients') }}">üîô Voltar</a>
    &nbsp;
    <a class="edit-button" href="{{ url_for('patients.edit_patient', id=patient.id) }}">Editar</a>
    &nbsp;
    <a class="remove-button" href="{{ url_for('patients.delete_patient', id=patient.id) }}">Remover</a>
</div>

{% endblock %}
